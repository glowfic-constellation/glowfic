= render 'search/breadcrumbs'

.search-collapsible
  .search-params-header
    Search Characters
    - if @search_results
      = "- #{@search_results.total_entries} results"
  .search-results-header
    - if @search_results
      = render 'posts/paginator', paginated: @search_results, no_per: true
  .search-box
    = form_tag search_characters_path, method: :get do
      .search-form
        .label= label_tag :author_id, 'Author'
        .select= select_tag :author_id, options_from_collection_for_select(@users, :id, :username, params[:author_id]), class: 'chosen-select', prompt: '— Choose Author —'
        .label= label_tag :template_id, 'Template'
        .select= select_tag :template_id, options_from_collection_for_select(@templates, :id, :name, params[:template_id]), class: 'chosen-select', prompt: '— Choose Template —'
        .label= label_tag :name, 'Name'
        .select= text_field_tag :name, params[:name]
        .label
        .checkbox-fields
          %span.fields-header Searching for name in:
          = check_box_tag :search_name, true, params[:commit] ? params[:search_name] : true
          = label_tag :search_name, "Name"
          = check_box_tag :search_screenname, true, params[:commit] ? params[:search_screenname] : true
          = label_tag :search_screenname, "Screenname"
          = check_box_tag :search_nickname, true, params[:commit] ? params[:search_nickname] : true
          = label_tag :search_nickname, "Nickname"
          -# TODO
            -# = check_box_tag :search_aliases, true, params[:commit] ? params[:search_aliases] : true, { class: 'vmid no-margin', style: 'margin-bottom: 3px;' }
            -# = label_tag :search_aliases, "Aliases"
        -# TODO: setting search, facecast search
        .search-form-ender= submit_tag "Search", class: 'button'
  .vtop
    - if @search_results.present?
      %table
        %thead
          %tr
            - klass = cycle('even'.freeze, 'odd'.freeze)
            %td.padding-5{class: klass}
              %b Name
            %td.padding-5{class: klass}
              %b Nickname
            %td.padding-5{class: klass}
              %b Screenname
            %td.padding-5{class: klass}
              %b Facecast
            %td.padding-5{class: klass}
              %b User
            -# TODO
              -# %td.padding-5{class: klass}
                -# %b Setting
        %tbody
          - @search_results.each do |character|
            - klass = cycle('even'.freeze, 'odd'.freeze)
            %tr
              %td.padding-5{class: klass}= link_to character.name, character_path(character)
              %td.padding-5{class: klass, style: 'width:15%'}= character.nickname
              %td.padding-5{class: klass, style: 'width:15%'}= breakable_text(character.screenname)
              %td.padding-5{class: klass, style: 'width:25%'}= character.pb
              %td.padding-5{class: klass, style: 'width:15%'}= user_link(character.user)

  - if @search_results && @search_results.total_pages > 1
    .search-params-header.empty
    .search-results-header= render 'posts/paginator', paginated: @search_results, no_per: true
