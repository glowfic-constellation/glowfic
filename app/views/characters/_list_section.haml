- col_count = 7
- col_count += 1 if local_assigns[:show_template]
- characters = name.characters.non_npcs.ordered unless local_assigns[:characters]
- characters = characters.where(retired: false) unless show_retired

- if @template.nil? && name.present?
  %tr
    %td.subber.character-list-template{colspan: col_count}
      - if name.is_a? String
        %b= name
        - if local_assigns[:show_new_character_button]
          = link_to new_character_path do
            .link-box.action-new{style: 'font-size: 14px'}= 'characters.new.button.generic'
      - else
        %b
          Template:
          = link_to name.name, template_path(name)
        - if current_user.try(:id) == name.user_id
          = link_to new_character_path(template_id: name.id) do
            .link-box.action-new{style: 'font-size: 14px'}= 'characters.new.button.instance'
          = link_to edit_template_path(name) do
            .link-box.action-edit{style: 'font-size: 14px'}
              = image_tag "icons/pencil.png", class: 'vmid', alt: ''
              = t('button.edit')
          = link_to template_path(name), method: :delete, data: { confirm: t('template.destroy.confirm') } do
            .link-box.action-delete{style: 'font-size: 14px'}= t('button.delete')
- if @template && @template.description.present?
  %tr
    %td.single-description.written-content{colspan: col_count}= sanitize_written_content(@template.description)
- elsif @template.nil? && name.present? && name.is_a?(::Template) && name.description.present?
  %tr
    %td.single-description.written-content{colspan: col_count}= sanitize_written_content(name.description)
- if characters.empty?
  %tr
    %td.centered.padding-5{class: cycle('even', 'odd'), colspan: col_count}= t('characters.index.empty')
- else
  %tr
    - klass = cycle('even', 'odd')
    %td.padding-5{class: klass}
      %b= tr('.header.name')
    - if local_assigns[:show_template]
      %td.padding-5{class: klass}
        %b= tr('.header.template')
    %td.padding-5{class: klass}
      %b= tr('.header.cluster')
    %td.padding-5{class: klass}
      %b= tr('.header.nickname')
    %td.padding-5{class: klass}
      %b= tr('.header.screenname')
    %td.padding-5{class: klass}
      %b= tr('.header.facecast')
    %td.padding-5{class: klass}
      - if local_assigns[:show_user]
        %b= tr('.header.user')
      - else
        %b= tr('.header.setting')
    %td.padding-5{class: klass}
  - pluck = characters_list(characters.ordered, local_assigns[:show_template])
  - params = { show_template: local_assigns[:show_template], show_user: local_assigns[:show_user], hide_buttons: local_assigns[:hide_buttons] }
  - params[:settings] = settings_info(characters) unless local_assigns[:show_user]
  = render partial: 'characters/list_item', collection: pluck, as: :character, locals: params
  - if characters.methods.include?(:total_pages) && characters.total_pages > 1
    %tfoot
      %tr
        %td{colspan: col_count}= render 'posts/paginator', paginated: characters
